<!DOCTYPE html>
<html>
	<head>
		<title>C++ Level Editor</title>
	</head>
	<body style="margin:0px;">
		<canvas id="cvs" width="640" height="480" style="border:1px solid #000;"></canvas>
		<canvas id="picker" width="640" height="480" style="border:1px solid #000;"></canvas><br />
		<input id="name" type="text" value="" />
		<button onclick="downloadScreen();">Download Test Screen</button>
		<script>
var screens = new Array(24*24);

var cvs = document.getElementById("cvs");
var ctx = cvs.getContext("2d");

var e = "e";

var screen = [
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,e,
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
];
var checker = [0,1,0,1,e,1,0,1,0,e,0,1,0,1,e,1,0,1,0];
			
function drawChecker(x, y)
{
    var posx = x;
    var posy = y;
    var colors = ["#ffffff", "#dddddd"];
    for(var i = 0; i < checker.length; i++)
    {
        if(checker[i] != e)
        {
            ctx.fillStyle = colors[checker[i]];
            ctx.fillRect(posx, posy, 8, 8);
            posx += 8;
        }
        else
        {
            posy += 8;
            posx = x;
        }
    }
}
function drawCheckerBackground()
{
    for(var i = 0; i < (480 / 32); i++)
    {
        for(var j = 0; j < (640 / 32); j++)
        {
            drawChecker((j * 32), (i * 32));
        }
    }
}
function drawGrid() {
    ctx.fillStyle = "#00ffff";
    
    for(var i = 0; i < (640 / 32); i++)
    {
        if(i > 0)ctx.fillRect((i * 32) - 1, 0, 2, 480);
    }
    for(var i = 0; i < (480 / 32); i++)
    {
        if(i > 0)ctx.fillRect(0, (i * 32)- 1, 640, 2);
    }
}
var mouseX;
var mouseY;
var drawing = false;
window.onmousemove = function(ev)
{
	mouseX = ev.x;
	mouseY = ev.y;
}
window.onmousedown = function()
{
	drawing = true;
}
window.onmouseup = function()
{
	drawing = false;
}
function drawMousePosRect()
{
    ctx.fillStyle = "rgba(127, 127, 127, 0.35)";
    ctx.fillRect((Math.ceil(mouseX/32)*32)-32, (Math.ceil(mouseY/32)*32)-32, 32, 32);
}
var currentTile = 1;
window.addEventListener('keydown', function(ev)
{
	var keyPressed = ev.key;
	var keyCode = ev.keyCode;
	if(keyCode == 48 || keyCode == 49 || keyCode == 50 || keyCode == 51 || keyCode == 52 || keyCode == 53 || keyCode == 54 ||
	  keyCode == 17 || keyCode == 67)
	{
		switch(keyPressed.toLowerCase())
		{
			case '0':
				currentTile = 0;
				break;
			case '1':
				currentTile = 1;
				break;
			case '2':
				currentTile = 2;
				break;
			case '3':
				currentTile = 3;
				break;
			case '4':
				currentTile = 4;
				break;
			case '5':
				currentTile = 5;
				break;
			case '6':
				currentTile = 6;
				break;
			case '7':
				currentTile = 7;
				break;
		}
	}
});
window.addEventListener('keyup', function(ev)
{
	if(ev.keyCode == 17)ctrlPressed = false;
});
var sx = 0;
var sy = 0;
var currentScreen = (sx + (sy * 20));

var picker = document.getElementById("picker");
var ptx = picker.getContext("2d");
function clearScreen_Pick()
{
	ptx.fillStyle = "#ffffff";
	ptx.fillRect(0, 0, 640, 480);
}
function drawMousePosRect_Pick()
{
	ptx.fillStyle = "rgba(127, 127, 127, 0.35)";
	ptx.fillRect((Math.ceil((mouseX/32)- 642/32)*32)-32, (Math.ceil(mouseY/32)*32)-32, 32, 32);
}
function drawTileset_Pick()
{
	var tileset = new Image(352, 192);
	tileset.src = "./tilesets/monastery_00.png";
	ptx.drawImage(tileset, 0, 0);
}
var pickerX = 0;
var pickerY = 0;
function setPickerPosition_Pick()
{
	if(drawing)
	{
		pickerX = (Math.ceil((mouseX - 642)/32)*32)-32;
		pickerY = (Math.ceil(mouseY/32)*32)-32;
	}
}
function drawPicker_Pick()
{
	ptx.strokeStyle = "#00ffff";
	ptx.strokeRect(pickerX, pickerY, 31, 31);
}
function draw()
{
	var mouseDrawX = (((Math.ceil(mouseX/32)*32)-32)/32);
	var mouseDrawY = (((Math.ceil(mouseY/32)*32)-32)/32)*21;
	var posArray = mouseDrawX + mouseDrawY;
	if(mouseX > 1 && mouseY > 1 && mouseX < 641 && mouseY < 481)
	{
		if(drawing)
		{
			screen[posArray] = currentTile;
		}
	}
}
function drawScreen()
{
	var x = 0;
	var y = 0;
	var colors = ["transparent", "#000000", "#ff0000", "#ffff00", "#00ff00", "#00ffff", "#0000ff"];
	for(var i = 0; i < screen.length; i++)
	{
		if(screen[i] != e)
		{
			ctx.fillStyle = colors[screen[i]];
			ctx.fillRect(x, y, 32, 32);
			x += 32;
		}
		else
		{
			y += 32;
			x = 0;
		}
	}
}
function drawMode()
{
	var text;
	switch(currentTile)
	{
		case 0:
			text = "Erase Mode";
			break;
		case 1:
			text = "Draw Mode";
			break;
	}
	ctx.font = "24px Monospace";
	ctx.textBaseline = "alphabetical baseline";
	ctx.fillStyle = "#00f";
	ctx.fillText(text, 5, 475);
}
function download(filename, code)
{
	var a = document.createElement("a");
	a.setAttribute("href", "data:text/plain;charset=utf-8," + encodeURIComponent(code));
	a.setAttribute("download", filename);
	
	a.style.display = "none";
	document.body.appendChild(a);
	
	a.click();
	
	document.body.removeChild(a);
}
function downloadScreen()
{
	var arrayContents;
	for(var i = 0; i < screen.length; i++)
	{
		if(screen[i] != e)arrayContents += screen[i] + ",";
		else continue;
	}
	var arrayWU = arrayContents.substring(9, arrayContents.split('').length);
	var array = "int screen[20*15] = { " + arrayWU + " };";
	download(document.getElementById("name").value + ".h", array);
}
var anim = function()
{
    requestAnimationFrame(anim);
    drawCheckerBackground();
	drawScreen();
	draw();
    drawMousePosRect();
	drawGrid();
	drawMode();
	clearScreen_Pick();
	drawTileset_Pick();
	drawPicker_Pick();
	setPickerPosition_Pick();
	drawMousePosRect_Pick();
}
anim();
		</script>
	</body>
</html>
